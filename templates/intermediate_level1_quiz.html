<!DOCTYPE html>
<html>
<head>
    <title>Level 1 Quiz: Fruits - VaaniMitra</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            background: linear-gradient(135deg, #c2e9fb 0%, #a1c4fd 100%);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 600px;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        .quiz-container {
            margin-top: 20px;
        }

        .question {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #2c3e50;
            text-align: center;
        }

        .fruit-image {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin: 0 auto 20px;
            display: block;
        }

        .options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .option {
            padding: 15px;
            background: white;
            border: 2px solid #a1c4fd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 1.2em;
        }

        .option:hover {
            background: #f0f7ff;
            border-color: #6c5ce7;
        }

        .option.selected {
            background: #6c5ce7;
            color: white;
            border-color: #6c5ce7;
        }

        .option.correct {
            background: #27ae60;
            color: white;
            border-color: #27ae60;
        }

        .option.incorrect {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }

        #progressBar {
            width: 100%;
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }

        #progressFill {
            height: 100%;
            background: linear-gradient(to right, #6c5ce7, #a1c4fd);
            width: 0;
            transition: width 0.3s ease;
        }

        .result {
            text-align: center;
            margin-top: 20px;
        }

        .score {
            font-size: 2em;
            color: #6c5ce7;
            margin: 20px 0;
        }

        .button {
            background: linear-gradient(to right, #6c5ce7, #a1c4fd);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.3s ease;
            margin-top: 20px;
            width: 100%;
        }

        .button:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Level 1 Quiz: Fruits in Hindi</h1>
        <div id="progressBar">
            <div id="progressFill"></div>
        </div>
        <div id="quiz-container" class="quiz-container">
            <!-- Quiz content will be loaded dynamically -->
        </div>
    </div>

    <script>
        const allFruits = [
            { english: 'Apple', hindi: 'सेब', image: '/static/images/fruits/apple.jpeg' },
            { english: 'Banana', hindi: 'केला', image: '/static/images/fruits/banana.jpg' },
            { english: 'Orange', hindi: 'संतरा', image: '/static/images/fruits/orange.jpeg' },
            { english: 'Mango', hindi: 'आम', image: '/static/images/fruits/mango.jpg' },
            { english: 'Grapes', hindi: 'अंगूर', image: '/static/images/fruits/grapes.jpeg' },
            { english: 'Papaya', hindi: 'पपीता', image: '/static/images/fruits/papaya.jpeg' },
            { english: 'Pomegranate', hindi: 'अनार', image: '/static/images/fruits/pomegranate.jpeg' },
            { english: 'Pear', hindi: 'नाशपाती', image: '/static/images/fruits/pear.jpeg' },
            { english: 'Strawberry', hindi: 'स्ट्रॉबेरी', image: '/static/images/fruits/strawberry.jpeg' },
            { english: 'Kiwi', hindi: 'कीवी', image: '/static/images/fruits/kiwi.jpeg' },
            { english: 'Pineapple', hindi: 'अनन्नास', image: '/static/images/fruits/pineapple.jpeg' },
            { english: 'Cherry', hindi: 'चेरी', image: '/static/images/fruits/cherry.jpeg' }
        ];

        // Shuffle array function
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Generate random options for a question
        function generateOptions(correctFruit) {
            let options = [correctFruit.hindi];
            let otherFruits = allFruits.filter(f => f.hindi !== correctFruit.hindi);
            shuffleArray(otherFruits);
            
            // Add 3 random wrong options
            options = options.concat(otherFruits.slice(0, 3).map(f => f.hindi));
            
            // Shuffle the options
            shuffleArray(options);
            
            return {
                options,
                correct: options.indexOf(correctFruit.hindi)
            };
        }

        // Generate quiz questions
        function generateQuiz() {
            // Shuffle and take 5 random fruits
            const selectedFruits = shuffleArray([...allFruits]).slice(0, 5);
            
            return selectedFruits.map(fruit => {
                const { options, correct } = generateOptions(fruit);
                return {
                    image: fruit.image,
                    question: `What is '${fruit.english}' called in Hindi?`,
                    options: options,
                    correct: correct
                };
            });
        }

        const quizData = generateQuiz();

        let currentQuestion = 0;
        let score = 0;
        let quizCompleted = false;

        function showQuestion() {
            const quiz = document.getElementById('quiz-container');
            const current = quizData[currentQuestion];
            
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = `${(currentQuestion / quizData.length) * 100}%`;

            quiz.innerHTML = `
                <div class="question">${current.question}</div>
                <img src="${current.image}" alt="Fruit" class="fruit-image">
                <div class="options">
                    ${current.options.map((option, index) => `
                        <div class="option" onclick="selectOption(${index})">
                            ${option}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function selectOption(optionIndex) {
            if (quizCompleted) return;

            const options = document.querySelectorAll('.option');
            const current = quizData[currentQuestion];

            options.forEach(option => option.classList.remove('selected', 'correct', 'incorrect'));
            options[optionIndex].classList.add('selected');

            if (optionIndex === current.correct) {
                options[optionIndex].classList.add('correct');
                score++;
            } else {
                options[optionIndex].classList.add('incorrect');
                options[current.correct].classList.add('correct');
            }

            setTimeout(() => {
                currentQuestion++;
                if (currentQuestion < quizData.length) {
                    showQuestion();
                } else {
                    showResult();
                }
            }, 1500);
        }

        function showResult() {
            const quiz = document.getElementById('quiz-container');
            const percentage = (score / quizData.length) * 100;
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = '100%';
            
            quiz.innerHTML = `
                <div class="result">
                    <h2>Quiz Completed!</h2>
                    <div class="score">${percentage}%</div>
                    <p>You got ${score} out of ${quizData.length} questions correct.</p>
                    <div class="feedback">
                        ${percentage >= 80 ? 
                            'Excellent! You can move to the next level!' : 
                            'Keep practicing! Try again to unlock the next level.'}
                    </div>
                    <button class="button" onclick="window.location.href='/intermediate'">
                        Return to Levels
                    </button>
                </div>
            `;

            // Send score to server
            fetch('/update-level-score', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    level: 1,
                    score: percentage
                })
            });

            quizCompleted = true;
        }

        // Start the quiz
        showQuestion();
    </script>
</body>
</html>
